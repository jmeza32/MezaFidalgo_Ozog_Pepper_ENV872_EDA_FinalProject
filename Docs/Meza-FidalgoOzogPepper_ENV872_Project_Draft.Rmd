---
title: "Marine Mammal and Sea Turtle Stranding Analysis"
author: "Joshua Meza-Fidalgo, Jess Ozog & Britney Pepper"
output:
  html_document:
    df_print: paged
    theme:
       bg: "#bfe6df"
       fg: "#000000"
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
subtitle: https://github.com/jmeza32/MezaFidalgo_Ozog_Pepper_ENV872_EDA_FinalProject.git
geometry: margin=2.54cm
fontsize: 12pt
mainfont: Times New Roman
---

-------------


```{r echo = FALSE, comment = FALSE, warning = FALSE, fig.cap = "Deceased Humpback Whale - Joshua Meza-Fidalgo, 2020", fig.align="right", out.width='100%'}
knitr::include_graphics('../Data/Images/CSC_0075.png')
```

-------------

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include = FALSE}
# Set your working directory
getwd()

# Load packages
library(tidyverse)
library(tidyr)
library(lubridate)
library(dplyr)
library(cowplot)
library(ggplot2)
library(ggridges)
library(agricolae)
library(lubridate)
library(corrplot)
library(htmltools)
library(sf)
library(leaflet)
library(mapview)
library(RColorBrewer)
library(leafsync)
library(trend)
library(zoo)
library(Kendall)
library(tseries)
library(knitr)
library(magrittr)

# Set your ggplot theme
mytheme <- theme_classic(base_size = 14) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "right")
theme_set(mytheme)

```



```{r data loading1, echo = FALSE}
#Raw Data
Strandings <- read.csv("../Data/Raw/OBIS_seamap_strandings_mystic.csv", stringsAsFactors = TRUE)

#Final Strandings file - Data Exploration
Strandings_Final <- read.csv("../Data/Processed/strandings_final.csv", stringsAsFactors = TRUE)
Strandings_Final <- Strandings_Final %>%
  select(Family:longitude)

#Final annual stranding file - Data Exploration
Annual_Strandings_Totals <- read.csv("../Data/Processed/annual_strandings_totals.csv", stringsAsFactors = TRUE)
Annual_Strandings_Totals <- Annual_Strandings_Totals %>%
  select(Year:Odontocetes_Total)

#Final monthly stranding file - Data Exploration
Monthly_Strandings_Totals <- read.csv("../Data/Processed/monthly_strandings_totals.csv", stringsAsFactors = TRUE)
Monthly_Strandings_Totals <- Monthly_Strandings_Totals %>%
  select(Month:Odontocetes_Total)
```



# Rationale and Research Questions

Marine mammal and sea turtle strandings can be unusual events or indicators of problems in our ocean ecosystems. Seeing patterns in the strandings of marine mammals and sea turtles can be indicative of more complex issues that may not be transparent. Some example of these issues could be viral outbreaks in lower trophic level populations or toxic algal blooms that kill off all sea life in the area. Because humans demand and consume seafood, understanding the problems that arise are essential to preventing the consumption of contaminated seafood along with the management of fisheries. By studying marine mammal and sea turtle strandings, we get insight on the health of our oceans.

Our objective is to analyze animal strandings over the years to see if there any trends in the quantity of strandings for each family (cetaceans, odontocetes, mysticetes, and pinnipeds). We have decided to look at the total number of strandings per year for all families, the changes in strandings over the years for each family and the seasonality differences across all years for each family. 


\newpage

# Dataset Information

<center>***Table 1**: Dataset Information*</center>

Detail            | Description
------------------|----------------------------------------
Data Source       | OBIS-SEAMAP  - Mystic Aquarium
Retrieved From    | https://seamap.env.duke.edu/dataset/945
Variables Used    | Family, Common Name, Species Name, Date, Year, Month, Latitude, Longitude, Total Strandings, Strandings by Species
Data Range        | March 18, 1976 to December, 29, 2011





The dataset that we chose to work with is the Mystic Aquarium's marine mammal and sea turtle stranding data that started in 1976 until 2011. However, there was only one stranding record in 1976, so that point was excluded from our analysis. The rest of the data started in 1990 and was concluded in 2011. It contains the number of whale (odontocetes and mysticetes), pinniped, and sea turtle strandings that occurred along the coasts of Connecticut, Rhode Island and Fishers Island, New York, USA. There were a total of 1140 strandings; within these strandings, 155 were odontocetes, 50 were mysticetes, 679 were pinnipeds, and 256 were sea turtles.

The dataset has a latitude that ranges from 41.00 to 41.86 while the longitude ranges from -73.65 to -71.10. We data was provided using the datum WGS 1984 (4326) and we performed a data transformation into UTM 19 (32619) for geospatial analysis. The data was wrangled to contain only the variables that we were interested in using. We then selected parts of the data based off of the Common Name of the species to create datasets that were easier for us to use in our analysis. This helped us divide the data into four groups: odontocetes, mysticetes, pinnipeds, and sea turtles. We initially looked at total yearly strandings for trends in the data for each family. After we analyzed the data on a monthly basis to help give insight to seasonal stranding trends for each family.



<center>***Figure 1**: The Column Names of the Raw Data*</center>
```{r - Table summary of the dataset structure1, message = FALSE, warning = FALSE, echo = FALSE}
colnames(Strandings)

```


<center>***Figure 2**: The Column Names of the Processed Data*</center>
```{r - Table summary of the dataset structure2, message = FALSE, warning = FALSE, echo = FALSE}
colnames(Strandings_Final)
```


<center>***Table 2**: The First Rows and Columns of the Final Processed Data*</center>
```{r - Table summary of the dataset structure3, message = FALSE, warning = FALSE, echo = FALSE}
head(Strandings_Final)
```


<center>***Table 3**: The First Rows and Columns of Strandings of Each Family per Year*</center>
```{r - Table summary of the dataset structure4, message = FALSE, warning = FALSE, echo = FALSE}
head(Annual_Strandings_Totals)
```


<center>***Table 4**: The First Rows and Columns of Strandings of Each Family per Month*</center>
```{r - Table summary of the dataset structure5, message = FALSE, warning = FALSE, echo = FALSE}
head(Monthly_Strandings_Totals)
```




\newpage

# Exploratory Analysis 

We initially decided that it would be best to look at the data holistically to get a better feel for the trends in the data. We first analyzed the total number of strandings per each family, as seen in Figure 3. To better see the data, we divided summed the strandings of each family for each year from 1990 to 2011, as seen in Figure 4. To see if there could be seasonal trends for the entire data set, the data was grouped by month for each family from the years 1990 to 2011, as seen in Figure 5. Finally, to have a geospatial understanding of our data, Map 1 was created.

<center>***Figure 3**: Total Strandings per Family*</center>
```{r Visually Exploring the Data 1, message = FALSE, warning = FALSE, echo = FALSE, fig.align = "center"}
ggplot(Strandings_Final) +
  geom_bar(aes(x = Family, fill = Family)) +
  ylab("Count") +
  labs(title = "Total Strandings per Family")
```


<center>***Figure 4**: Total Strandings per Year*</center>
```{r Visually Exploring the Data 2, message = FALSE, warning = FALSE, echo = FALSE, fig.align = "center"}
ggplot(Strandings_Final) +
  geom_bar(aes(x = Year, fill = Family)) +
  ylab("Count") +
  labs(title = "Total Strandings per Year")
```


<center>***Figure 5**: Total Strandings per Month*</center>
```{r Visually Exploring the Data 3, message = FALSE, warning = FALSE, echo = FALSE, fig.align = "center"}
ggplot(Strandings_Final) +
  geom_bar(aes(x = Month, fill = Family)) +
  ylab("Count") +
  labs(title = "Total Strandings per Month") +scale_x_discrete(name = "Month",
                   limits = c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
```

<center>***Map 1**: Geospatial Exploration of each Family*</center>
<center>
```{r Geospatial Exploration, message = FALSE, warning = FALSE, echo = FALSE, fig.align = "center"}
Strandings_sf <- Strandings_Final %>%
  st_as_sf(coords = c("longitude", "latitude"), crs = 4326)

mapview(Strandings_sf, zcol = "Family")
```
</center>

\newpage

# Analysis
* Flow between text and visualizations is cohesive
* Visualizations and statistical tests pertain directly to specific questions 
* Statistical results are reported in plain language with relevant statistical output in parentheses 
* Findings are reported clearly in relation to research questions


NOTE-- Did we ever do an analysis for the entire data set without dividing it by family????


Because we decided to divide the data into groups by their families, we conducted separate analysis for each of the families. Our research questions are the following:

* Are there years or months where the number of strandings for each family are significantly different?
* Are there trends in the family strandings based off this dataset?


1. **Pinnipeds**:
```{r Pinniped Data Setup, message = FALSE, warning = FALSE, include= FALSE}
#Wrangling for pinniped only data
Pinniped_Stranding_Data <- Strandings_Final %>%
  filter(Family == "Pinnipeds") %>%
  select(Family:longitude)

Pinniped_Stranding_Data$Date <- as.Date(Pinniped_Stranding_Data$Date, format = "%Y-%m-%d")

Pinniped_Stranding_Totals <- Pinniped_Stranding_Data %>%
                    filter(Family == "Pinnipeds") %>%
                    group_by(Date) %>%
                    summarise(Total = n())


#Wrangling pinniped strandings by year
Annual_Pinniped_Strandings <- Annual_Strandings_Totals %>%
  select(Year, Pinnipeds_Total)

#Wrangling pinniped strandings by month
Monthly_Pinniped_Strandings <- Monthly_Strandings_Totals %>%
  select(Month, Pinnipeds_Total)

```


#Pinniped Data Exploration
```{r Pinniped Data Exploration, message = FALSE, warning = FALSE, echo = FALSE}
summary(Pinniped_Stranding_Data)

#Plot of annual pinniped strandings
ggplot(Pinniped_Stranding_Data) +
  geom_bar(aes(x = Year, fill = common_name)) +
  ylab("Count") +
  labs(title = "Total Pinniped Strandings per Year by Species") + 
  scale_fill_discrete(name = "Pinniped Species", labels = c("Atlantic Gray Seal", "Harbor Seal", "Harp Seal", "Hooded Seal", "Unidentified Pinniped"))

#Plot of overall monthly pinniped strandings
ggplot(Pinniped_Stranding_Data) +
  geom_bar(aes(x = Month, fill = common_name)) +
  ylab("Count") +
  labs(title = "Total Pinniped Strandings per Month by Species") + 
  scale_fill_discrete(name = "Pinniped Species", labels = c("Atlantic Gray Seal", "Harbor Seal", "Harp Seal", "Hooded Seal", "Unidentified Pinniped")) +
  scale_x_discrete(name = "Month",
                   limits = c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))

#Plot of annual pinniped strandings with trend line
Pinniped_Stranding_Plot <-
ggplot(Annual_Pinniped_Strandings, aes(x = Year, y = Pinnipeds_Total)) +
  geom_line(color = "red") +
  ylab("Pinniped Strandings") +
  geom_smooth(method = lm) +
  labs(title = "Pinniped Strandings Per Year")

print(Pinniped_Stranding_Plot)
```

Pinniped data exploration indicates a possible overall increasing trend in pinniped strandings and a possible monthly/seasonal trend.  There is some fluctuation in number of total yearly strandings both for the family as a whole and at the species level, although a more detailed species level analysis is beyond the scope of this project. Harp and harbor seals make up most of the strandings each year. Most yearly strandings occur in the late winter and spring time, particularly in March, with very few in the late summer through the early winter.  Springtime coincides with the pupping seasons for many seal species and could be a factor in this.


```{r Pinniped Geospatial Exploration, message = FALSE, warning = FALSE, echo = FALSE}
#Spatial frame to visualize the stranding data spatially.
Pinniped_sf <- Pinniped_Stranding_Data %>%
  st_as_sf(coords = c("longitude", "latitude"), crs = 4326)

mapview(Pinniped_sf)
```

Pinniped strandings are most numerous throughout the coastline of Rhode Island and the eastern coastline of Connecticut.



#Pinniped Stranding Analysis

#Pinniped Statisical Analysis

Null Hypothesis 1: There is no effect of year on the total number of pinniped strandings
Alternative Hypothesis 1: There is an effect of year on the total number of pinniped strandings

Null Hypothesis 2: There is no effect of month on the total number of pinniped strandings
Alternative Hypothesis 2: There is an effect of month on the total number of pinniped strandings

```{r Pinniped Poisson Models, message = FALSE, warning = FALSE, echo = FALSE}
#Developing an model to analysis the significance of year on pinniped strandings
Annual_Pinniped_Model <- glm(data = Annual_Pinniped_Strandings, Pinnipeds_Total ~ factor(Year), family = poisson)

summary(Annual_Pinniped_Model)


#Developing an model to analysis the significance of month on pinniped strandings
Monthly_Pinniped_Model <- glm(data = Monthly_Pinniped_Strandings, Pinnipeds_Total ~ factor(Month), family = poisson)

summary(Monthly_Pinniped_Model)
```

We reject the null hypothesis that there is no effect of year on the total number of pinniped strandings.  18 of the 21 documented years were statistically significant with p-values ranging from 9.07e-09(2001) to 0.03(1999).  Only the first three years of data, 1991-1993 had p-values above 0.05.  The null deviance of yearly model was 1.36e+02 on 21 degrees of freedom, and residual deviance of 1.31e-14

We reject the null hypothesis that there is no effect of month on the total number of pinniped strandings.  11 of the 12 months had p-values of less than 0.05, with July being the exception.  The p-values of the statistically significant month ranged from 1.77e-15(March) to 0.02(June).  The null deviance for the monthly model was 5.95e+02 on 11 degrees of freedom and a residual deviance of -3.55e-15. 

This information can lead to further study as to why years and months differ and develop ways to predict and/or mitigate particularly bad years and/or months for pinnped strandings.


#Pinniped Geospatial Analysis
```{r}
#Converting the data points to UTM for further analysis. The study are straddles UTM zones 18 and 19, zone 19 was chosen because that is where the greatest concentration of points seems to be located.

Pinniped_sf_utm <- st_transform(Pinniped_sf,32619)

Pinniped_sf_utm$geometry

#Determining "mean" stranding point for distance comparisons
long_mean <- mean(Pinniped_Stranding_Data$longitude)
lat_mean <- mean(Pinniped_Stranding_Data$latitude)

Pinniped_Stranding_Mean_Point <- data.frame(long_mean, lat_mean)

Pinniped_Mean_sf <- Pinniped_Stranding_Mean_Point %>%
  st_as_sf(coords = c("long_mean", "lat_mean"), crs = 4326)

Pinniped_Mean_UTM <- st_transform(Pinniped_Mean_sf,32619)

#Creating a distance matrix for further analysis
Pinniped_Distance_Matrix <- st_distance(Pinniped_sf_utm, Pinniped_sf_utm, pairwise = T)

mean_distance <-  rowMeans(Pinniped_Distance_Matrix)

Pinniped_sf_utm  <-  Pinniped_sf_utm %>% 
  bind_cols(mean_distance = mean_distance)
```


```{r}
#Visualizing stranding point distance from "mean"
mapview(Pinniped_sf_utm, 
        zcol = "mean_distance",
        layer.name = "Distance (m) from Mean Stranding Point")
```


```{r Distance Table}
#Developing a mean distance table

# points within 40,000m
Pinniped_40 <- Pinniped_sf_utm %>%
  filter(mean_distance < 40000) %>%
  mutate(distance_group = "< 40,000")

# points between 40,000m - 60,000m
Pinniped_40_60 <- Pinniped_sf_utm %>%
  filter(mean_distance >= 40000 & mean_distance < 60000) %>%
  mutate(distance_group = "40,000 - 60,000")

# points between 60,000m - 80,000m
Pinniped_60_80 <- Pinniped_sf_utm %>%
  filter(mean_distance >= 60000 & mean_distance < 80000) %>%
  mutate(distance_group = "60,000 - 80,000")

# points between 80,000m - 100,000m
Pinniped_80_100 <- Pinniped_sf_utm %>%
  filter(mean_distance >= 80000 & mean_distance < 100000) %>%
  mutate(distance_group = "80,000 - 100,000")

# points between 100,000m - 120,000m
Pinniped_100_120 <- Pinniped_sf_utm %>%
  filter(mean_distance >= 100000 & mean_distance < 120000) %>%
  mutate(distance_group = "100,000 - 120,000")

# points between 120,000m - 140,000m
Pinniped_120_140 <- Pinniped_sf_utm %>%
  filter(mean_distance >= 120000 & mean_distance < 140000) %>%
  mutate(distance_group = "120,000 - 140,000")

# points between 140,000m - 160,000m
Pinniped_140_160 <- Pinniped_sf_utm %>%
  filter(mean_distance >= 140000 & mean_distance < 160000) %>%
  mutate(distance_group = "140,000 - 160,000")

# points greater than 160,000m
Pinniped_160 <- Pinniped_sf_utm %>%
  filter(mean_distance >= 160000) %>%
  mutate(distance_group = "> 160,000")

# row bind the distance dataframes
Pinniped_sf_utm_final <- rbind(Pinniped_40, Pinniped_40_60, Pinniped_60_80, Pinniped_80_100, Pinniped_100_120, Pinniped_120_140, Pinniped_140_160, Pinniped_160)

Pinniped_distances <- Pinniped_sf_utm_final %>%
  group_by(distance_group) %>%
  summarise(totals_by_distance = n()) %>%
  st_drop_geometry() %>%
  arrange(totals_by_distance)

kable(Pinniped_distances)
```

By finding the "mean" stranding location based on the all of the data points it can be determined how far each stranding point is from the mean.  By determining that 425 out of 679, or 62.5 percent of, pinniped strandings occur within 40km of the mean stranding location, what makes this area a hotspot can be studied and hopefully also determined.  This data also could allow for reallocation of stranding resources and personnel to this range in order to put them to the most efficient use possible.  Since only 54, or 8 percent of, pinniped strandings occur further than 60km from the stranding mean, resources for study and rescue can be allocated away from those areas.


#Pinniped Temporal Analysis

Null Hypothesis: The yearly and/or monthly/seasonal pinniped stranding data is stationary
Alternative Hypothesis: The yearly and/or monthly/seasonal pinniped stranding data is not stationary

```{r Monthly Time Series}
#Developing a monthly time series to determine if there is a monthly/seasonal trend.
f_month <- month(first(Pinniped_Stranding_Totals$Date))
f_year <- year(first(Pinniped_Stranding_Totals$Date))


Pinniped_ts_monthly <- ts(Pinniped_Stranding_Totals$Total, 
                  start = c(f_year, f_month), 
                  frequency = 12)
 
Pinniped_ts_monthly_decomp <- stl(Pinniped_ts_monthly, s.window = "periodic")
plot(Pinniped_ts_monthly_decomp)

Pinniped_ts_monthly_trend <- Kendall::SeasonalMannKendall(Pinniped_ts_monthly)

summary(Pinniped_ts_monthly_trend)
```

We fail to reject the H0 that monthly pinniped strandings are stationary, with a p-value of 0.48, but there could be some seasonality based on the decomposition


```{r Yearly Time Series}
#Developing a yearly time series to determine if there is a trend
Pinniped_ts_yearly <- ts(Pinniped_Stranding_Totals, start = c(1990,1), frequency = 1)

Pinniped_ts_yearly_trend <- Kendall::SeasonalMannKendall(Pinniped_ts_yearly)

summary(Pinniped_ts_yearly_trend)
```

We reject the H0 that yearly pinniped strandings are stationary with a p-value or 2.22e-16.  This analysis fits with the trend line plotting in the exploration of the pinniped data.



2. **Whales**:
-*Odontocetes*

```{r Odontocete Data, message = FALSE, warning = FALSE, include= FALSE}
stranding_data <- read.csv("../Data/Processed/strandings_final.csv", stringsAsFactors = TRUE)

#Odontocetes Data
odontocete_stranding_data <- stranding_data %>%
  filter(Family == "Odontocetes") %>%
  select(Family:longitude)

#Setting the date
odontocete_stranding_data$Date <- as.Date(odontocete_stranding_data$Date, format = "%Y-%m-%d")


#Annual Strandings
annual_strandings_totals <- read.csv("../Data/Processed/annual_strandings_totals.csv", stringsAsFactors = TRUE)

annual_odontocetes_strandings <- annual_strandings_totals %>%
  select(Year, Odontocetes_Total)

#Monthly Strandings
monthly_strandings_totals <- read.csv("../Data/Processed/monthly_strandings_totals.csv", stringsAsFactors = TRUE)

monthly_odontocetes_strandings <- monthly_strandings_totals %>%
  select(Month, Odontocetes_Total)



#Odontocete Stranding Numbers
odontocete_stranding_numbers <- odontocete_stranding_data %>%
                    filter(Family == "Odontocetes") %>%
                    group_by(Date) %>%
                    summarise(Total = n())
```


#Odontocete Data Exploration
```{r Odontocete Data Exploration, message = FALSE, warning = FALSE, echo = FALSE}
summary(odontocete_stranding_data)

#By year
ggplot(odontocete_stranding_data) +
  geom_bar(aes(x = Year, fill = common_name)) +
  ylab("Count") +
  labs(title = "Total Odontocete Strandings per Year by Species") +
  scale_fill_discrete(name = "Odontocete Species", labels = c("Atlantic White-sided Dolphin", "Blainville's Beaked Whale","Common Bottlenose Dolphin", "Dwarf Sperm Whale", "Harbor Porpoise","Long-finned Pilot Whale", "Pygmy Sperm Whale", "Risso's Dolphin", "Short-beaked Common Dolphin", "Short-finned Pilot Whale", "Sowerby's Beaked Whale", "Striped Dolphin", "Unidentified Toothed Whales"))

#By month
ggplot(odontocete_stranding_data) +
  geom_bar(aes(x = Month, fill = common_name)) +
  ylab("Count") +
  labs(title = "Total Odontocete Strandings per Month by Species") + 
  scale_fill_discrete(name = "Odontocete Species", labels = c("Atlantic White-sided Dolphin", "Blainville's Beaked Whale","Common Bottlenose Dolphin", "Dwarf Sperm Whale", "Harbor Porpoise","Long-finned Pilot Whale", "Pygmy Sperm Whale", "Risso's Dolphin", "Short-beaked Common Dolphin", "Short-finned Pilot Whale", "Sowerby's Beaked Whale", "Striped Dolphin", "Unidentified Toothed Whales")) +
  scale_x_discrete(name = "Month",
                   limits = c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
```

There appears to be an increasing trend in the number of odontocete strandings as the years progress.
There may be possible seasonal trend based on season, where the spring and early summer see a greater number of strandings than the other seasons.



```{r Odontocete Geospatial Exploration, message = FALSE, warning = FALSE, echo = FALSE}
odontocete_sf <- odontocete_stranding_data %>%
  st_as_sf(coords = c("longitude", "latitude"), crs = 4326)

mapview(odontocete_sf)
```



#Odontocete Analysis
##Statisical Analysis

Null Hypothesis 1: There is no effect of year on the total number of odontocete strandings
Alternative Hypothesis 1: There is an effect of year on the total number of odontocete strandings

Null Hypothesis 2: There is no effect of month on the total number of odontocete strandings
Alternative Hypothesis 2: There is an effect of month on the total number of odontocete strandings

```{r Odontocete ANOVA Models, message = FALSE, warning = FALSE, echo = FALSE}
odontocete_model <- aov(data = annual_odontocetes_strandings, Odontocetes_Total ~ Year)
odontocete_model

summary.aov(odontocete_model)

odontocete_model2 <- aov(data = monthly_odontocetes_strandings, Odontocetes_Total ~ Month)
odontocete_model2

summary.aov(odontocete_model2)
```

We reject the null hypothesis that there is no effect of year on the total number of odontocete strandings due to a p-value of 2.16e-06. We also fail to reject the null hypothesis that there is no effect of month on the total number of odontocete strandings due to a p-value of 0.424. This indicates that there is a difference in the number of odontocete strandings across the years of the study, but not across the months. This could be explained by increase boat and shipping traffic as the years progress that contribute to increased ocean noise and interference with their communication that have led them to become stranded. Seasonality may not have an effect because of the consistency of boat and ship traffic throughout each year.



#Geospatial Analysis
```{r Odontocete Geospatial Analysis, message = FALSE, warning = FALSE, include = FALSE}
#Transform the data to UTM 19
odontocete_sf_utm <- st_transform(odontocete_sf,32619)
#The data points straddle UTM zones 18 and 19, zone 19 was chosen because that is where the greatest concentration of points seems to be located.

odontocete_sf_utm$geometry


odo_long_mean <- mean(odontocete_stranding_data$longitude)
odo_lat_mean <- mean(odontocete_stranding_data$latitude)

odontocete_stranding_mean_point <- data.frame(odo_long_mean, odo_lat_mean)

odontocete_mean_sf <- odontocete_stranding_mean_point %>%
  st_as_sf(coords = c("odo_long_mean", "odo_lat_mean"), crs = 4326)

odontocete_mean_utm <- st_transform(odontocete_mean_sf,32619)

odontocete_distance_matrix <- st_distance(odontocete_sf_utm, odontocete_sf_utm, pairwise = T)

odo_mean_distance <-  rowMeans(odontocete_distance_matrix)

odontocete_sf_utm  <-  odontocete_sf_utm %>% 
  bind_cols(odo_mean_distance = odo_mean_distance)
```

```{r Odontocete Mapping the mean distance, message = FALSE, warning = FALSE, echo = FALSE}
mapview(odontocete_sf_utm, 
        zcol = "odo_mean_distance",
        layer.name = "Distance (m) from Mean Stranding Point")
```

Knowing where the "mean" stranding location is could allow for a study of that area in order to determine why odontocete strandings are so prominent on this area and allow for the allocation of more recovery resources and personnel to that area to compensate for the higher levels of strandings. Much of the strandings occurred from Charlestown to Newport, in the Rhode Island Sound.




```{r Odontocete Distance Table, message = FALSE, warning = FALSE, echo = FALSE}
# points within 40,000m
odontocete_40 <- odontocete_sf_utm %>%
  filter(odo_mean_distance < 40000) %>%
  mutate(distance_group = "< 40,000")

# points between 40,000m - 60,000m
odontocete_40_60 <- odontocete_sf_utm %>%
  filter(odo_mean_distance >= 40000 & odo_mean_distance < 60000) %>%
  mutate(distance_group = "40,000 - 60,000")

# points between 60,000m - 80,000m
odontocete_60_80 <- odontocete_sf_utm %>%
  filter(odo_mean_distance >= 60000 & odo_mean_distance < 80000) %>%
  mutate(distance_group = "60,000 - 80,000")

# points between 80,000m - 100,000m
odontocete_80_100 <- odontocete_sf_utm %>%
  filter(odo_mean_distance >= 80000 & odo_mean_distance < 100000) %>%
  mutate(distance_group = "80,000 - 100,000")

# points between 100,000m - 120,000m
odontocete_100_120 <- odontocete_sf_utm %>%
  filter(odo_mean_distance >= 100000 & odo_mean_distance < 120000) %>%
  mutate(distance_group = "100,000 - 120,000")

# points between 120,000m - 140,000m
odontocete_120_140 <- odontocete_sf_utm %>%
  filter(odo_mean_distance >= 120000 & odo_mean_distance < 140000) %>%
  mutate(distance_group = "120,000 - 140,000")

# points between 140,000m - 160,000m
odontocete_140_160 <- odontocete_sf_utm %>%
  filter(odo_mean_distance >= 140000 & odo_mean_distance < 160000) %>%
  mutate(distance_group = "140,000 - 160,000")

# points greater than 160,000m
odontocete_160 <- odontocete_sf_utm %>%
  filter(odo_mean_distance >= 160000) %>%
  mutate(distance_group = "> 160,000")

# row bind the distance dataframes
odontocete_sf_utm_final <- rbind(odontocete_40, odontocete_40_60, odontocete_60_80, odontocete_80_100, odontocete_100_120, odontocete_120_140, odontocete_140_160, odontocete_160)

odontocete_distances <- odontocete_sf_utm_final %>%
  group_by(distance_group) %>%
  summarise(totals_by_distance = n()) %>%
  st_drop_geometry() %>%
  arrange(totals_by_distance)

kable(odontocete_distances)
```


#Temporal Analysis
Null Hypothesis: The odontocetes stranding data is stationary
Alternative Hypothesis: The odontocetes stranding data is not stationary

```{r Odontocete Monthly Time Series, message = FALSE, warning = FALSE, echo = FALSE}
odo_f_month <- month(first(odontocete_stranding_numbers$Date))
odo_f_year <- year(first(odontocete_stranding_numbers$Date))

odontocete_ts_monthly <- ts(odontocete_stranding_numbers$Total, 
                  start = c(odo_f_year, odo_f_month), 
                  frequency = 12)
 
odontocete_ts_monthly_decomp <- stl(odontocete_ts_monthly, s.window = "periodic")
plot(odontocete_ts_monthly_decomp)

odontocete_ts_monthly_trend <- Kendall::SeasonalMannKendall(odontocete_ts_monthly)

summary(odontocete_ts_monthly_trend)

```
Because the 2-sided p-value was 0.434, we fail to reject the null hypothesis and say that odontocetes monthly stranding data is stationary.



```{r Odontocete Yearly Time Series, message = FALSE, warning = FALSE, echo = FALSE}
odo_f_year <- year(first(odontocete_stranding_numbers$Date))

odontocete_ts_yearly <- ts(odontocete_stranding_numbers, start = c(1990,1), frequency = 1)

odontocete_ts_yearly_trend <- Kendall::SeasonalMannKendall(odontocete_ts_yearly)

summary(odontocete_ts_yearly_trend)
```
Because the 2-sided p-value was less 7.53e-12, we reject the null hypothesis and say that odontocete yearly stranding data is not stationary. 



## 3. Sea Turtles:
```{r Turtle Data Setup, message = FALSE, warning = FALSE, include= FALSE}
# read in the strandings data
Strandings <- read.csv("../Data/Processed/strandings_final.csv", stringsAsFactors = TRUE)
Turtle_Stranding_Data <- Strandings %>%
  filter(Family == "Turtles") %>%
  select(Family:longitude)
Turtle_Stranding_Data$Date <- as.Date(Turtle_Stranding_Data$Date, format = "%Y-%m-%d")

# strandings by YEAR (for statistical analysis)
Strandings_Totals_Year <- read.csv("../Data/Processed/strandings_totals.csv", stringsAsFactors = TRUE)
Turtle_Strandings_Year <- Strandings_Totals_Year %>%
  select(Year, Turtles_Total)

# strandings by MONTH (for statistical analysis)
Strandings_Totals_Month <- read.csv("../Data/Processed/monthly_strandings_totals.csv", stringsAsFactors = TRUE)
Turtle_Strandings_Month <- Strandings_Totals_Month %>%
  select(Month, Turtles_Total)

# turtle strandings summed by date (for time series)
Turtle_Stranding_by_date <- Turtle_Stranding_Data %>%
                    group_by(Date) %>%
                    summarise(Total = n())
```

**Turtle Data Exploration**
```{r Turtle Exploratory Analysis, message = FALSE, warning = FALSE, echo = FALSE}
summary(Turtle_Stranding_Data)

# plot of the turtle strandings by year
ggplot(Turtle_Stranding_Data) +
  geom_bar(aes(x = Year, fill = common_name)) +
  ylab("Count") +
  labs(title = "Total Sea Turtle Strandings per Year by Species") +
  scale_fill_discrete(name = "Sea Turtle Species", labels = c("Green", "Kemp's Ridley", "Leatherback", "Loggerhead", "Unidentified Turtle"))

# plot of turtle strandings by month
ggplot(Turtle_Stranding_Data) +
  geom_bar(aes(x = Month, fill = common_name)) +
  ylab("Count") +
  labs(title = "Total Sea Turtle Strandings per Month by Species") + 
  scale_fill_discrete(name = "Sea Turtle Species", labels = c("Green", "Kemp's Ridley", "Leatherback", "Loggerhead", "Unidentified Turtle")) +
  scale_x_discrete(name = "Month",
                   limits = c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
```


Exploratory analysis of the sea turtle stranding data set by year shows higher amounts of strandings in the early 1990s and late 2000s, with the highest amount in 1995. The most prominent species throughout our study period appear to be leatherback sea turtles, followed by loggerhead sea turtles. Through monthly data exploration, strandings peak from July to September and occur less frequently the remainder of the year.

**Turtle Spatial Analysis**
```{r Turtle Spatial Analysis, message = FALSE, warning = FALSE, echo = FALSE}
# create spatial frame of turtle data
Turtle_sf <- Turtle_Stranding_Data %>%
  st_as_sf(coords = c("longitude", "latitude"), crs = 4326)
#mapview(Turtle_sf)

# used UTM Zone 19 (data spans across UTM zone 18 and 19)
Turtle_sf_utm <- st_transform(Turtle_sf, 32619)
#mapview(Turtle_sf_utm)

# find average lat and longs
avgLong_Turtle <- mean(Turtle_Stranding_Data$longitude)
avgLat_Turtle <- mean(Turtle_Stranding_Data$latitude)
avg_Turtle_coords <- data.frame(avgLong_Turtle, avgLat_Turtle)

# center point of the turtle strandings 
avg_Turtle_sf <- avg_Turtle_coords %>%
  st_as_sf(coords = c("avgLong_Turtle", "avgLat_Turtle"), crs = 4326)
avg_Turtle_sf_utm <- st_transform(avg_Turtle_sf, 32619)
#mapview(avg_Turtle_sf_utm)

# find how far each stranding is from the mean stranding location
distance_matrix <- st_distance(Turtle_sf_utm, avg_Turtle_sf_utm, pairwise=T)
#Compute the mean of each row (each EPA site)
mean_distances <-  rowMeans(distance_matrix)
#Add as a column to the epa sites
Turtle_sf_utm  <-  Turtle_sf_utm %>% 
  bind_cols(mean_distance = mean_distances) 

# make a pretty map 
mapview(Turtle_sf_utm, zcol="mean_distance", layer.name = "Distance (m) from Mean Stranding Point")
```

**Turtle Spatial Table**
```{r Turtle Spatial Table, message = FALSE, warning = FALSE, include = FALSE}
# points within 20,000m
Turtle_20 <- Turtle_sf_utm %>%
  filter(mean_distance < 20000) %>%
  mutate(distance_group = "< 20,000")

# points between 20,000m - 40,000m
Turtle_20_40 <- Turtle_sf_utm %>%
  filter(mean_distance >= 20000 & mean_distance < 40000) %>%
  mutate(distance_group = "20,000 - 40,000")

# points between 40,000m - 60,000m
Turtle_40_60 <- Turtle_sf_utm %>%
  filter(mean_distance >= 40000 & mean_distance < 60000) %>%
  mutate(distance_group = "40,000 - 60,000")

# points between 60,000m - 80,000m
Turtle_60_80 <- Turtle_sf_utm %>%
  filter(mean_distance >= 60000 & mean_distance < 80000) %>%
  mutate(distance_group = "60,000 - 80,000")

# points between 80,000m - 100,000m
Turtle_80_100 <- Turtle_sf_utm %>%
  filter(mean_distance >= 80000 & mean_distance < 100000) %>%
  mutate(distance_group = "80,000 - 100,000")

# points between 100,000m - 120,000m
Turtle_100_120 <- Turtle_sf_utm %>%
  filter(mean_distance >= 100000 & mean_distance < 120000) %>%
  mutate(distance_group = "100,000 - 120,000")

# points between 120,000m - 140,000m
Turtle_120_140 <- Turtle_sf_utm %>%
  filter(mean_distance >= 120000 & mean_distance < 140000) %>%
  mutate(distance_group = "120,000 - 140,000")

# points between 140,000m - 160,000m
Turtle_140_160 <- Turtle_sf_utm %>%
  filter(mean_distance >= 140000 & mean_distance < 160000) %>%
  mutate(distance_group = "140,000 - 160,000")

# points greater than 160,000m
Turtle_160 <- Turtle_sf_utm %>%
  filter(mean_distance >= 160000) %>%
  mutate(distance_group = "> 160,000")

# row bind the distance dataframes
Turtle_sf_utm_final <- rbind(Turtle_20, Turtle_20_40,Turtle_40_60,
                             Turtle_60_80,Turtle_80_100,Turtle_100_120,
                             Turtle_120_140,Turtle_140_160,Turtle_160)

Turtle_distances <- Turtle_sf_utm_final %>%
  group_by(distance_group) %>%
  summarise(totals_by_distance = n()) %>%
  st_drop_geometry() %>%
  arrange(totals_by_distance)

#kable(Turtle_distances)
```
Distance (m) | Number of Strandings
---------------|--------------------
less than 20,000 | 92
20,000 - 40,000 | 113
40,000 - 60,000 | 32
60,000 - 80,000 | 2
80,000 - 100,000 | 4
100,000 - 120,000 | 2
120,000 - 140,000 | 6
140,000 - 160,000 | 4
greater than 160,000 | 1

Of the 256 sea turtle strandings used in our analysis, 113 of them occured within 20,000 - 40,000m of the mean stranding location, followed by 92 strandings within 20,000m of the mean location (Table 1). These points were in the areas around Charlestown, RI, Newport, RI and New Shoreham, RI. This high concentration of strandings can indicate that these areas may be sea turtle stranding hotspots. This could be due to various factors, such as the flow of oceanic currents, anthropogenic impacts (such as higher fishing presrure), or the fact that there may be more manpower employed in these areas that could make stranding detection easier. Further research is needed to determine how these underlying factors may be contibuting to sea turtle strandings in these areas. 


**Turtle Statistical Analysis**

Null Hypothesis 1: There is no effect of individual year on sea turtle strandings.   
Alternative Hypothesis 1: There is an effect of individual year on sea turtle strandings. 

Null Hypothesis 2: There is no effect of month on sea turtle strandings.  
Alternative Hypothesis 2: There is an effect of month on sea turtle strandings. 

```{r Turtle Statistical Analysis,message = FALSE, warning = FALSE, include = FALSE}
Turtle_Model_Year <- glm(data = Turtle_Strandings_Year, Turtles_Total ~ factor(Year), family = poisson)
summary(Turtle_Model_Year)

Turtle_Model_Month <- glm(data = Turtle_Strandings_Month, Turtles_Total ~ factor(Month), family = poisson)
summary(Turtle_Model_Month)
```
Yearly Analysis:
We reject the null hypothesis that individual year has no effect on sea turtle strandings. The sea turtle strandings in 9 of the 21 years are not significantly different (p-values: 0.147 - 0.706). 1995 was the most significantly different (p-value: 0.000236). 1991 (p-value: 0.0056), 1993 (p-value: 0.0078), 2008 (p-value: 0.0022), 2010 (p-value: 0.0016), and 2011 (p-value: 0.003) were the next most statitistically different years. The null deviance of this model is 7.4606e+01, which indicates ??? The residual deviance of this model is -4.8850e-15, which indicates ??? 

Monthly Analysis:
We reject the null hypothesis that month has no effect on sea turtle strandings. Of the 12 months, 5 of months were significantly different. May (p-value: 0.000269), June (p-value: 3.98e-06), July (p-value: 1.91e-05), August (p-value: 0.004106), and September (p-value: 0.049935) were significantly different. This indicates that sea turtle strandings are concentrated to the summer months in our study area. The null deviance of this model is 4.9235e+02, which indicates ??? The residual deviance of this model is 3.0332e-10, which indicates ???


**Turtle Time Series**

Null hypothesis:  
Alternative hypothesis:

```{r Turtle Time Series, message = FALSE, warning = FALSE, include = FALSE}
# time series by year
Turtle_ts_yearly <- ts(Turtle_Stranding_by_date, start = c(1990,1), frequency = 1)

# time series by month
f_month_turtle <- month(first(Turtle_Stranding_by_date$Date))
f_year_turtle <- year(first(Turtle_Stranding_by_date$Date))
Turtle_ts_monthly <- ts(Turtle_Stranding_by_date$Total, 
                  start = c(f_year_turtle, f_month_turtle), 
                  frequency = 12)
# monthly decomposition 
Turtle_ts_monthly_decomp <- stl(Turtle_ts_monthly, s.window = "periodic")
plot(Turtle_ts_monthly_decomp)

# Trends
Turtle_ts_yearly_trend <- Kendall::SeasonalMannKendall(Turtle_ts_yearly)
summary(Turtle_ts_yearly_trend)

Turtle_ts_monthly_trend <- Kendall::SeasonalMannKendall(Turtle_ts_monthly)
summary(Turtle_ts_monthly_trend)
```

\newpage


# Summary and Conclusions
* Major findings are summarized
* Conclusions relate back to the original research context 




\newpage

-------------

```{r echo=FALSE, comment=FALSE, warning=FALSE, fig.cap = "Deceased Fin Whale - Joshua Meza-Fidalgo, 2020", fig.align="right", out.width='100%'}
knitr::include_graphics('../Data/Images/CSC_1077.png')

```


-------------

# References

**Data**: <https://seamap.env.duke.edu/dataset/945> 

1. Halpin, P.N., A.J. Read, E. Fujioka, B.D. Best, B. Donnelly, L.J. Hazen, C. Kot, K. Urian, E. LaBrecque, A. Dimatteo, J. Cleary, C. Good, L.B. Crowder, and K.D. Hyrenbach. 2009. OBIS-SEAMAP: The world data center for marine mammal, sea bird, and sea turtle distributions. Oceanography. 22(2):104-115.

2. Smith, A. 2014. Mystic Aquarium's marine mammal and sea turtle stranding data 1976-2011. Data downloaded from OBIS-SEAMAP (http://seamap.env.duke.edu/dataset/945) on 2022-04-02.

**Photos**: Special thanks to Joshua Meza-Fidalgo for providing whale photos for us to use.

---
title: "Pinniped Analysis"
author: "Joshua Meza-Fidalgo"
date: '2022-04-02'
output:
  html_document:
    df_print: paged
---
>Set Up

```{r Setup, warning = FALSE, message = FALSE}
library(tidyverse)
library(tidyr)
library(lubridate)
library(dplyr)
library(cowplot)
library(ggplot2)
library(ggridges)
library(agricolae)
library(lubridate)
library(corrplot)
library(htmltools)
library(sf)
library(leaflet)
library(mapview)
library(RColorBrewer)
library(leafsync)
library(trend)
library(zoo)
library(Kendall)
library(tseries)

getwd()

mytheme <- theme_bw() +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "right")
theme_set(mytheme)
```


```{r Data Setup}
Stranding_Data <- read.csv("../Data/Processed/strandings_final.csv", stringsAsFactors = TRUE)

Pinniped_Stranding_Data <- Stranding_Data %>%
  filter(Family == "Pinnipeds") %>%
  select(Family:longitude)

Pinniped_Stranding_Data$Date <- as.Date(Pinniped_Stranding_Data$Date, format = "%Y-%m-%d")

Annual_Strandings_Totals <- read.csv("../Data/Processed/annual_strandings_totals.csv", stringsAsFactors = TRUE)

Annual_Pinniped_Stranding_Totals <- Annual_Strandings_Totals %>%
  select(Year, Pinnipeds_Total)
```


>Pinniped Data Exploration

```{r Pinniped Data Exploration}
summary(Pinniped_Stranding_Data)

ggplot(Pinniped_Stranding_Data) +
  geom_bar(aes(x = Year, fill = common_name)) +
  ylab("Count") +
  labs(title = "Total Pinniped Strandings per Year by Species") + 
  scale_fill_discrete(name = "Pinniped Species", labels = c("Atlantic Gray Seal", "Harbor Seal", "Harp Seal", "Hooded Seal", "Unidentified Pinniped"))


ggplot(Pinniped_Stranding_Data) +
  geom_bar(aes(x = Month, fill = common_name)) +
  ylab("Count") +
  labs(title = "Total Pinniped Strandings per Month by Species") + 
  scale_fill_discrete(name = "Pinniped Species", labels = c("Atlantic Gray Seal", "Harbor Seal", "Harp Seal", "Hooded Seal", "Unidentified Pinniped")) +
  scale_x_discrete(name = "Month",
                   limits = c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
```

```{r Geospatial Exploration}
Pinniped_sf <- Pinniped_Stranding_Data %>%
  st_as_sf(coords = c("longitude", "latitude"), crs = 4326)

mapview(Pinniped_sf)
```



>Pinniped Analysis


>>Statisical Analysis

Null Hypothesis: There is no effect of year on the total number of pinniped strandings
Alternative Hypothesis: There is an effect of year on the total number of pinniped strandings

```{r ANOVA Model}
Pinniped_Model <- aov(data = Annual_Pinniped_Stranding_Totals, Pinnipeds_Total ~ Year)

Pinniped_Model

summary.aov(Pinniped_Model)
```

We reject the null hypothesis that there is no effect of year on the total number of pinniped strandings due to a p-value of 0.027.  This  effect could likely be explained by differing environmental factors each year, however our dataset did not include such data.  This could be an avenue of further research for a future project, if such environmental data is available.    


>>Geospatial Analysis

```{r}
Pinniped_sf_utm <- st_transform(Pinniped_sf,32619)
#The data points straddle UTM zones 18 and 19, zone 19 was chosen because that is where the greatest concentration of points seems to be located.

Pinniped_sf_utm$geometry


long_mean <- mean(Pinniped_Stranding_Data$longitude)
lat_mean <- mean(Pinniped_Stranding_Data$latitude)

Pinniped_Stranding_Mean_Point <- data.frame(long_mean, lat_mean)

Pinniped_Mean_sf <- Pinniped_Stranding_Mean_Point %>%
  st_as_sf(coords = c("long_mean", "lat_mean"), crs = 4326)

Pinniped_Mean_UTM <- st_transform(Pinniped_Mean_sf,32619)


Pinniped_Distance_Matrix <- st_distance(Pinniped_sf_utm, Pinniped_sf_utm, pairwise = T)

mean_distance <-  rowMeans(Pinniped_Distance_Matrix)

Pinniped_sf_utm  <-  Pinniped_sf_utm %>% 
  bind_cols(mean_distance = mean_distance)
```

```{r}
mapview(Pinniped_sf_utm, 
        zcol = "mean_distance",
        layer.name = "Distance (m) from Mean Stranding Point")
```

Knowing where the "mean" stranding location is could allow for a study of that area in order to determine why pinniped strandings are so prominent on this area and allow for the allocation of more recovery resources and personnel to that area to compensate for the higher levels of strandings. 


>>Temporal Analysis

Null Hypothesis: The yearly pinniped stranding data is stationary
Alternative Hypothesis: The yearly pinniped stranding data is not stationary

```{r Annual Time Series Analysis}
Pinniped_ts <- ts(Annual_Pinniped_Stranding_Totals, start = c(1990,1), frequency = 1)

Pinniped_ts_trend_annual <- Kendall::SeasonalMannKendall(Pinniped_ts)

summary(Pinniped_ts_trend_annual)
```

We fail to reject the null hypothesis that the yearly pinniped stranding data is stationary based on a p-value of 0.09




Null Hypothesis: The seasonal pinniped stranding data is stationary
Alternative Hypothesis: The seasonal pinniped stranding data is not stationary

```{r Monthly Time Series Analysis}
f_month <- month(first(Pinniped_Stranding_Data$Date))
f_year <- year(first(Pinniped_Stranding_Data$Date))
Pinniped_ts_monthly <- ts(Pinniped_Stranding_Data,
                   start=c(f_year,f_month),
                   frequency=12) 

Pinniped_ts_trend_monthly <- Kendall::SeasonalMannKendall(Pinniped_ts_monthly)

summary(Pinniped_ts_trend_monthly)


Pinniped_ts_seasonal <- ts(Pinniped_Stranding_Data,
                   start=c(f_year,f_month),
                   frequency=4)

Pinniped_ts_trend_seasonal <- Kendall::SeasonalMannKendall(Pinniped_ts_seasonal)

summary(Pinniped_ts_trend_seasonal)
```

We reject the null hypothesis that the yearly pinniped stranding data is stationary based on a p-value of 8.8818e-16.



```{r Seasonal Time Series Analysis}
Pinniped_ts_seasonal <- ts(Pinniped_Stranding_Data,
                   start=c(f_year,f_month),
                   frequency=4)

Pinniped_ts_trend_seasonal <- Kendall::SeasonalMannKendall(Pinniped_ts_seasonal)

summary(Pinniped_ts_trend_seasonal)
```
